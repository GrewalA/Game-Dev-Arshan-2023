<!DOCTYPE html>
<html>
<head>
  <title>Canvas Game</title>
  <style>
    canvas {
      border: 1px solid black;
      display: block;
      margin: 0 auto;
    }
  </style>
</head>
<body>
  <canvas id="myCanvas" width="480" height="320"></canvas>

  <script>
    const canvas = document.getElementById('myCanvas');
    const ctx = canvas.getContext('2d');

    // Game variables
    let GameRunning = false;
    let disableType = false;
    let died = false;
    let timer = 0;
    let minigunBool = false;
    let minigunTimer = 0;
    let mouseDown = false;
    let canFire = true;

    // Player variables
    let playerX = canvas.width / 2;
    let playerY = canvas.height / 2;
    const dotRadius = 10;
    const playerColor = 'green';
    let dx = 0;
    let dy = 0;
    const playerSpeed = 5;

    // Bullet variables
    let bullets = [];
    const bulletRadius = 5;
    let bulletTemp = 0;
    const bulletSpeed = 500; // Decreased bullet reload time

    // Enemy variables
    let enemies = [];
    const enemyRadius = 10;
    const enemyColor = 'red';
    let enemyCount = 0;
    const enemySpeed = 3;

    // Event listeners for player movement
    document.addEventListener('keydown', handleKeyDown);
    document.addEventListener('keyup', handleKeyUp);

    // Function to handle key down event
    function handleKeyDown(event) {
      if (!disableType) {
        if (event.key === 'w') {
          dy = -playerSpeed;
        } else if (event.key === 'a') {
          dx = -playerSpeed;
        } else if (event.key === 's') {
          dy = playerSpeed;
        } else if (event.key === 'd') {
          dx = playerSpeed;
        }
      }
    }

    // Function to handle key up event
    function handleKeyUp(event) {
      if (!disableType) {
        if (event.key === 'w' || event.key === 's') {
          dy = 0;
        } else if (event.key === 'a' || event.key === 'd') {
          dx = 0;
        }
      }
    }

    // Function to handle mouse move event
    function handleMouseMove(event) {
      if (mouseDown) {
        const rect = canvas.getBoundingClientRect();
        playerX = event.clientX - rect.left;
        playerY = event.clientY - rect.top;
      }
    }

    // Function to handle mouse down event
    function handleMouseDown(event) {
      mouseDown = true;
    }

    // Function to handle mouse up event
    function handleMouseUp(event) {
      mouseDown = false;
    }

    // Function to handle mouse click event
    function handleMouseClick(event) {
      if (canFire) {
        bullets.push({ x: playerX, y: playerY, dx: dx, dy: dy });
        canFire = false;
        bulletTemp = bulletSpeed;
      }
    }

    // Function to handle enemy dot creation
    function createEnemy() {
      const x = Math.random() < 0.5 ? -enemyRadius : canvas.width + enemyRadius;
      const y = Math.random() * canvas.height;
      const dx = Math.random() < 0.5 ? enemySpeed : -enemySpeed;
      const dy = Math.random() * enemySpeed - enemySpeed / 2;
      enemies.push({ x: x, y: y, dx: dx, dy: dy });
      enemyCount++;
    }

    // Function to update the game state
    function update() {
      // Clear the canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Update player position
      playerX += dx;
      playerY += dy;

      // Draw player
      ctx.beginPath();
      ctx.arc(playerX, playerY, dotRadius, 0, Math.PI * 2);
      ctx.fillStyle = playerColor;
      ctx.fill();
      ctx.closePath();

      // Update and draw bullets
      for (let i = 0; i < bullets.length; i++) {
        bullets[i].x += bullets[i].dx;
        bullets[i].y += bullets[i].dy;
        ctx.beginPath();
        ctx.arc(bullets[i].x, bullets[i].y, bulletRadius, 0, Math.PI * 2);
        ctx.fillStyle = 'black';
        ctx.fill();
        ctx.closePath();
      }

      // Remove bullets outside the canvas
      bullets = bullets.filter((bullet) => {
        return bullet.x > 0 && bullet.x < canvas.width && bullet.y > 0 && bullet.y < canvas.height;
      });

      // Update and draw enemies
      for (let i = 0; i < enemies.length; i++) {
        enemies[i].x += enemies[i].dx;
        enemies[i].y += enemies[i].dy;
        ctx.beginPath();
        ctx.arc(enemies[i].x, enemies[i].y, enemyRadius, 0, Math.PI * 2);
        ctx.fillStyle = enemyColor;
        ctx.fill();
        ctx.closePath();

        // Check for collision between enemies and bullets
        for (let j = 0; j < bullets.length; j++) {
          const distance = Math.sqrt(
            Math.pow(enemies[i].x - bullets[j].x, 2) + Math.pow(enemies[i].y - bullets[j].y, 2)
          );
          if (distance < enemyRadius + bulletRadius) {
            // Remove enemy and bullet on collision
            enemies.splice(i, 1);
            i--;
            bullets.splice(j, 1);
            break;
          }
        }

        // Check for collision between player and enemies
        const distance = Math.sqrt(
          Math.pow(enemies[i].x - playerX, 2) +
            Math.pow(enemies[i].y - playerY, 2)
        );

        if (distance < enemyRadius + dotRadius) {
          GameRunning = false;
          disableType = false;
          died = true;
          alert('Game Over!');
          break;
        }
      }

      // Update bullet reload time
      if (!canFire) {
        bulletTemp--;
        if (bulletTemp <= 0) {
          canFire = true;
        }
      }

      // Update minigun powerup timer
      if (minigunBool) {
        minigunTimer--;
        if (minigunTimer <= 0) {
          minigunBool = false;
          bulletSpeed = 1000; // Reset bullet reload time
        }
      }

      // Check if the game is still running
      if (GameRunning) {
        requestAnimationFrame(update);
      }
    }

    // Function to start the game
    function startGame() {
      disableType = true;
      GameRunning = true;
      enemyCount = 0;
      enemies = [];
      bullets = [];
      playerX = canvas.width / 2;
      playerY = canvas.height / 2;

      // Add event listeners
      document.addEventListener('mousemove', handleMouseMove);
      document.addEventListener('mousedown', handleMouseDown);
      document.addEventListener('mouseup', handleMouseUp);
      document.addEventListener('click', handleMouseClick);

      // Create initial enemies after 2 seconds
      setTimeout(() => {
        if (GameRunning) {
          createEnemy();
          createEnemy();
        }
      }, 2000);

      // Create additional enemy after 4 seconds
      setTimeout(() => {
        if (GameRunning) {
          createEnemy();
        }
      }, 4000);

      // Start the game loop
      update();
    }

    // Start the game
    startGame();
  </script>
</body>
</html>
